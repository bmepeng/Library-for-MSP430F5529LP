
//If you are editing your project with IAR, you should include 
//<msp430_____(the model of your development board).h> rather than <msp430.h>
#include <msp430.h>
#include "lcd.h"

const uint8_t Number[2][10][8] =
{
	{
		0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,
		0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,
		0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,
		0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,
		0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,
		0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,
		0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,
		0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,
		0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,
		0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00
	},
	{
		0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,
		0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,
		0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,
		0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,
		0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,
		0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,
		0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,
		0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,
		0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,
		0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00
	}
};

void LCD_Init()
{
	P6DIR |= BIT6 +BIT3 +BIT0;
	P3DIR |= BIT3;
	P1DIR |= BIT2;
        //If your LCD model is different from mine, you should find your LCD's
        //initialize method in data sheet.
	LCD_CS_L;
	LCD_RES_L;
	LCD_Delay(400);
	LCD_RES_H;
	LCD_Delay(400);
	LCD_Command(0xE2);
	LCD_Delay(20);
	LCD_Command(0x2C);
	LCD_Delay(20);
	LCD_Command(0x2E);
	LCD_Delay(20);
	LCD_Command(0x2F);
	LCD_Delay(20);
	LCD_Command(0x23);
	LCD_Command(0x81);
	LCD_Command(0x28);
	LCD_Command(0xC8);
	LCD_Command(0xA0);
	LCD_Command(0xA6);
	LCD_Command(0xAf);
	LCD_Clear();
}


void LCD_Disp_uint(uint8_t x,uint8_t y,unsigned int num)
{
	uint8_t digit=1;
	uint8_t temp_digit;
	uint8_t digit_count=0;
	uint8_t i,j,k;
	unsigned int temp=num;
	while(temp>=10)
	{
		digit *= 10;
		temp /= 10;
	}
	for(i=0;i<2;i++)
	{
		LCD_Address(x+i,(y<<3));
		for(temp_digit = digit;temp_digit>0;temp_digit/=10)
		{
			j = num / temp_digit % 10;
			digit_count++;
			for(k=0;k<8;k++)
			{
				LCD_Data(Num[i][j][k]);
			}
		}
		//The while below decide how long a unsigned int have to be on
		//the LCD screen, you can modify it by your own requirement.
		while(digit_count<5)
		{
			digit_count++;
			for(k=0;k<8;k++)
			{
				LCD_Data(Num[i][j][k]);
			}
		}
	}
}


void LCD_Clear()
{
	uint8_t x,y;
	for(y=0;y<8;y++)
	{
		LCD_Command(0xB0+y);
		LCD_Command(0x10);
		LCD_Command(0x00);
		for(x=0;x<128;x++)
		{
			LCD_Data(0x00);
		}
	}
}


void LCD_Address(uint8_t page,uint8_t column)
{
	column -= 1;
	page -= 1;
	LCD_Command(0xB0 + page);
	LCD_Command(( (column >> 4) & 0x0F) + 0x10);
	LCD_Command(column & 0x0F);
}


void LCD_Command(uint8_t data)
{
	LCD_CS_L;
	LCD_CD_L;
	LCD_Byte(data);
	LCD_CS_H;
}


void LCD_Data(uint8_t data)
{
	LCD_CS_L;
	LCD_CD_H;
	LCD_Byte(data);
	LCD_CS_H;
}


void LCD_Byte(uint8_t data)
{
	uint8_t i;
	for(i=0;i<8;i++)
	{
		LCD_SCK_L;
		if(data&0x80)
		{
			LCD_SDA_H;
		}
		else
		{
			LCD_SDA_L;
		}
		LCD_SCK_H;
		data = data << 1;
	}
}


void LCD_Delay(uint8_t i)
{
	int j,k;
	for(j=0;j<i;j++)
	{
		for(k=0;k<110;k++);
	}
}
